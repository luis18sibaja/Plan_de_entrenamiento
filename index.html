<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plan de Entrenamiento Progresivo: 3 Meses</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            scroll-behavior: smooth;
            background-color: #111827;
            color: #e5e7eb;
        }
        .tab-active {
            background-color: #f97316;
            color: white;
            box-shadow: 0 5px 20px rgba(249, 115, 22, 0.4);
        }
        .tab-inactive {
            background-color: transparent;
            color: #d1d5db;
        }
        .day-btn {
            background-color: #374151;
            color: #e5e7eb;
            transition: all 0.3s ease-in-out;
        }
        .accordion-item {
            background-color: rgba(31, 41, 55, 0.5);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: box-shadow 0.3s ease-in-out, border-color 0.3s ease-in-out;
        }
        .accordion-item.illuminated {
            box-shadow: 0 0 25px rgba(251, 146, 60, 0.3), inset 0 0 10px rgba(251, 146, 60, 0.1);
        }

        /* --- Sistema de Temas de Color --- */
        .day-btn.active { color: white; transform: translateY(-2px); }

        /* Tema Día 1: Naranja Intenso */
        .theme-day1 .day-btn.active { background-color: #f97316; box-shadow: 0 4px 15px rgba(249, 115, 22, 0.4); }
        .theme-day1 .accordion-header .theme-marker, .theme-day1 .accordion-icon { color: #f97316; }
        .theme-day1 .exercise-card .theme-arrow { color: #f97316; }
        .scheduled.theme-day1::after { background-color: #f97316; }
        .assign-btn-day1:hover { background-color: #f97316 !important; }
        #todays-workout-info .theme-border-day1 { border-color: #f97316; }
        .highlight-benefit.theme-day1 { background-color: rgba(249, 115, 22, 0.15); color: #f97316; }

        /* Tema Día 2: Ámbar Energético */
        .theme-day2 .day-btn.active { background-color: #f59e0b; box-shadow: 0 4px 15px rgba(245, 158, 11, 0.4); }
        .theme-day2 .accordion-header .theme-marker, .theme-day2 .accordion-icon { color: #f59e0b; }
        .theme-day2 .exercise-card .theme-arrow { color: #f59e0b; }
        .scheduled.theme-day2::after { background-color: #f59e0b; }
        .assign-btn-day2:hover { background-color: #f59e0b !important; }
        #todays-workout-info .theme-border-day2 { border-color: #f59e0b; }
        .highlight-benefit.theme-day2 { background-color: rgba(245, 158, 11, 0.15); color: #f59e0b; }

        /* Tema Día 3: Rojo Potencia */
        .theme-day3 .day-btn.active { background-color: #ef4444; box-shadow: 0 4px 15px rgba(239, 68, 68, 0.4); }
        .theme-day3 .accordion-header .theme-marker, .theme-day3 .accordion-icon { color: #ef4444; }
        .theme-day3 .exercise-card .theme-arrow { color: #ef4444; }
        .scheduled.theme-day3::after { background-color: #ef4444; }
        .assign-btn-day3:hover { background-color: #ef4444 !important; }
        #todays-workout-info .theme-border-day3 { border-color: #ef4444; }
        .highlight-benefit.theme-day3 { background-color: rgba(239, 68, 68, 0.15); color: #ef4444; }
        /* --- Fin del Sistema de Temas de Color --- */

        .accordion-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.7s cubic-bezier(0.4, 0, 0.2, 1), padding 0.7s cubic-bezier(0.4, 0, 0.2, 1);
            padding: 0 1.5rem;
        }
        .accordion-content.open {
            max-height: 2000px;
            padding: 1.5rem;
        }
        .modal-backdrop { transition: opacity 0.3s ease-in-out; }
        .modal-content { transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.4s ease-in-out; }
        .modal-backdrop, .modal-content {
            opacity: 0;
            transform: scale(0.95) translateY(10px);
            pointer-events: none;
        }
        .modal-backdrop.open, .modal-content.open {
            opacity: 1;
            transform: scale(1) translateY(0);
            pointer-events: auto;
        }
        .progress-bar-fill {
            transition: width 0.5s ease-in-out;
        }
        .initial-hidden {
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.6s ease-out, transform 0.6s ease-out;
        }
        .fade-in {
            opacity: 1;
            transform: translateY(0);
        }
        .category-tag {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        .chart-container {
            position: relative;
            width: 100%;
            height: 250px;
        }
        .accordion-icon {
            transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .timeline-container {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none;
        }
        .timeline-container::-webkit-scrollbar {
            display: none;
        }
        .timeline-day, .grid-day {
            background-color: #374151;
            border-radius: 0.75rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease-in-out;
            position: relative;
        }
        .timeline-day { flex: 0 0 60px; padding: 0.75rem 0.25rem; }
        .grid-day { aspect-ratio: 1/1; display: flex; flex-direction: column; justify-content: center; align-items: center; padding: 2px; }
        .timeline-day:hover, .grid-day:hover:not(.out-of-range) { background-color: #4b5563; }
        .scheduled::after {
            content: '';
            position: absolute;
            bottom: 6px;
            left: 50%;
            transform: translateX(-50%);
            width: 6px;
            height: 6px;
            border-radius: 50%;
        }
        .completed {
            font-weight: bold;
        }
        .completed::after { display: none !important; }
        .timeline-day.today, .grid-day.today { border: 2px solid #fb923c; }
        .grid-day.other-month { color: #4b5563; background-color: #1f2937; cursor: default; }
        .grid-day.in-range { background-color: rgba(55, 65, 81, 0.5); }
        .grid-day.start-date, .timeline-day.start-date { background-color: #fbbf24; color: #111827; }
        .grid-day.out-of-range, .timeline-day.out-of-range { background-color: #1f2937; color: #4b5563; cursor: not-allowed; }

        /* Estilos de Días Completados (Movidos para Prioridad) */
        .completed.theme-day1, .grid-day.completed.theme-day1 { background-color: #f97316; color: #111827; box-shadow: 0 0 15px rgba(249, 115, 22, 0.5); }
        .completed.theme-day2, .grid-day.completed.theme-day2 { background-color: #f59e0b; color: #111827; box-shadow: 0 0 15px rgba(245, 158, 11, 0.5); }
        .completed.theme-day3, .grid-day.completed.theme-day3 { background-color: #ef4444; color: #111827; box-shadow: 0 0 15px rgba(239, 68, 68, 0.5); }

        #view-toggle:checked ~ .relative .dot {
            transform: translateX(1.5rem);
            background-color: #f97316;
        }
        .highlight-benefit {
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: 600;
        }
    </style>
</head>
<body class="antialiased">

    <div id="app" class="max-w-7xl mx-auto p-4 md:p-8">
        <header class="text-center mb-10 initial-hidden">
            <h1 class="text-4xl sm:text-5xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-amber-400 to-orange-500 tracking-tight">Tu Viaje de 3 Meses</h1>
            <p class="text-lg sm:text-xl text-slate-400 mt-2">Plan Progresivo para Movilidad y Fuerza Funcional</p>
        </header>

        <div id="main-nav" class="sticky top-4 z-40 bg-[#111827]/80 backdrop-blur-sm py-4 initial-hidden">
            <div class="w-full bg-gray-700 rounded-full h-3 mb-4 shadow-inner">
                <div id="progress-bar" class="bg-gradient-to-r from-amber-500 to-orange-600 h-3 rounded-full progress-bar-fill" style="width: 33.33%"></div>
            </div>
            <nav class="flex justify-center p-1 bg-gray-800/80 rounded-full shadow-lg">
                <button data-month="1" class="month-tab flex-1 py-3 px-2 text-center font-semibold text-sm sm:text-lg transition-all duration-300 rounded-full tab-active">Mes 1: Adaptación</button>
                <button data-month="2" class="month-tab flex-1 py-3 px-2 text-center font-semibold text-sm sm:text-lg transition-all duration-300 rounded-full tab-inactive">Mes 2: Intensificación</button>
                <button data-month="3" class="month-tab flex-1 py-3 px-2 text-center font-semibold text-sm sm:text-lg transition-all duration-300 rounded-full tab-inactive">Mes 3: Potencia</button>
            </nav>
        </div>

        <main id="plan-content" class="transition-opacity duration-500 mt-8">
        </main>

        <section id="progress-section" class="mt-12 initial-hidden">
             <div class="bg-gray-800/50 p-4 sm:p-6 rounded-2xl shadow-lg border border-gray-700">
                <div class="flex flex-col sm:flex-row justify-between items-center mb-4 gap-4">
                    <h2 class="text-2xl lg:text-3xl font-bold text-slate-200">Planificador</h2>
                    <label for="view-toggle" class="flex items-center cursor-pointer flex-shrink-0">
                        <span id="view-label-left" class="mr-3 text-sm font-medium">Progreso</span>
                        <div class="relative">
                            <input type="checkbox" id="view-toggle" class="sr-only">
                            <div class="block bg-gray-600 w-14 h-8 rounded-full">
                                <div class="dot absolute left-1 top-1 bg-white w-6 h-6 rounded-full transition"></div>
                            </div>
                        </div>
                        <span id="view-label-right" class="ml-3 text-sm font-medium">Planificación</span>
                    </label>
                </div>

                <div id="calendar-container"></div>
                <div id="todays-workout-info" class="mt-4"></div>

                <div class="grid grid-cols-1 lg:grid-cols-5 gap-8 mt-8">
                    <div class="lg:col-span-3">
                         <h3 class="text-lg sm:text-xl font-bold text-white mb-4 text-center lg:text-left">Análisis de Cumplimiento (12 Semanas)</h3>
                        <div class="chart-container h-64">
                            <canvas id="compliance-chart"></canvas>
                        </div>
                    </div>
                    <div class="lg:col-span-2 space-y-4">
                         <h3 class="text-lg sm:text-xl font-bold text-white mb-4 text-center lg:text-left">Inteligencia de Entrenamiento</h3>
                         <div class="bg-gray-900/50 p-4 rounded-xl">
                            <p class="text-sm text-slate-400">Cumplimiento Total</p>
                            <p id="total-compliance" class="text-3xl font-extrabold text-amber-400">0%</p>
                        </div>
                         <div class="bg-gray-900/50 p-4 rounded-xl">
                            <p class="text-sm text-slate-400">Racha de Semanas Perfectas</p>
                            <p id="perfect-streak" class="text-3xl font-extrabold text-orange-500">0</p>
                        </div>
                         <div class="bg-gray-900/50 p-4 rounded-xl">
                            <p class="text-sm text-slate-400">Entrenamientos Totales</p>
                            <p id="total-workouts" class="text-3xl font-extrabold text-white">0</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

    </div>

    <div id="exercise-modal" class="modal-backdrop fixed inset-0 bg-black/80 flex items-center justify-center p-4 z-50">
        <div class="modal-content bg-[#1f2937] border border-gray-700 rounded-2xl shadow-2xl w-full max-w-lg max-h-[90vh] overflow-y-auto">
            <div class="p-2 text-right">
                 <button id="modal-close" class="text-slate-400 hover:text-red-500 transition-colors text-5xl leading-none">&times;</button>
            </div>
            <div class="p-4 md:p-6 pt-0">
                 <img id="modal-img" src="" alt="Demostración del ejercicio" class="w-full h-auto object-cover rounded-xl shadow-lg mb-4" onerror="this.onerror=null;this.src='https://placehold.co/600x400/111827/d1d5db?text=Imagen+no+disponible';">
                <div class="flex flex-col h-full">
                    <div id="modal-tags" class="mb-3"></div>
                    <h3 id="modal-title" class="text-2xl md:text-3xl font-extrabold text-white mb-2"></h3>
                    <div class="w-16 h-1.5 bg-gradient-to-r from-amber-400 to-orange-500 rounded-full mb-4"></div>
                    <p id="modal-desc" class="text-slate-300 leading-relaxed overflow-y-auto"></p>
                </div>
            </div>
        </div>
    </div>

    <div id="assignment-modal" class="modal-backdrop fixed inset-0 bg-black/80 flex items-center justify-center p-4 z-50">
        <div class="modal-content bg-[#1f2937] border border-gray-700 rounded-2xl shadow-2xl w-full max-w-md">
             <div class="p-6 text-center">
                <h3 id="assignment-title" class="text-xl sm:text-2xl font-bold text-white mb-4"></h3>
                <p id="assignment-date" class="text-slate-400 mb-6"></p>
                <div id="assignment-options" class="space-y-3"></div>
                <button id="delete-assignment" class="hidden mt-4 w-full p-3 bg-red-800/50 rounded-lg text-red-400 font-semibold hover:bg-red-700/50 transition-colors">Borrar Programación</button>
                <button id="cancel-assignment" class="mt-6 text-slate-400 hover:text-white">Cancelar</button>
             </div>
        </div>
    </div>
<script>
document.addEventListener('DOMContentLoaded', () => {

// --- REGISTRO DE PLUGINS DE CHART.JS ---
Chart.register(ChartDataLabels);

// --- DATOS DEL PLAN DE ENTRENAMIENTO (CON DESCRIPCIONES DETALLADAS) ---
const planData = {
    warmups: {
        "1": [
            { name: "Respiración Diafragmática", reps: "2-3 minutos", desc: "Ejecución: Acuéstate boca arriba, rodillas flexionadas, pies en el suelo. Una mano en el pecho, otra en el abdomen. Inhala lento por la nariz (4s), sintiendo cómo tu abdomen se expande. Sostén (2s) y exhala por la boca (6s).\n\n<span class='highlight-benefit'>Ayuda a:</span> Activar el core, calmar el sistema nervioso y mejorar la oxigenación.", img: "https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExd2Z0eXNsa2RtaGs4aTRlM2ZxM2Z2b2pucXFqaHNxcnRibXkxYTVpNiZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/27c3yD3aAI36pYd95n/giphy.gif", category: "Movilidad" },
            { name: "Gato-Vaca", reps: "15 reps lentas", desc: `Ejecución: En cuatro puntos (manos bajo hombros, rodillas bajo caderas). Inhala (Vaca): arquea la espalda, levanta cabeza y coxis. Exhala (Gato): redondea la columna, mete ombligo y barbilla.\n\n<span class='highlight-benefit'>Ayuda a:</span> Despertar y lubricar la columna vertebral, aumentando la flexibilidad y liberando tensión.`, img: "https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExb214M2s2b3VwaHk4eWl6eDN6a2d0dHZ0ZmJpNHNqYjZocG5zZzB0ciZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/VbnUQpnihPSaVFnqHe/giphy.gif", category: "Movilidad" },
            { name: "Bird-Dog", reps: "10 reps x lado", desc: `Ejecución: En cuatro puntos, contrae el abdomen. Extiende brazo derecho y pierna izquierda a la vez, paralelos al suelo, sin rotar la cadera. Mantén 3 segundos y regresa controladamente. Alterna.\n\n<span class='highlight-benefit'>Ayuda a:</span> Fortalecer el core profundo, mejorar el equilibrio, la coordinación y la postura.`, img: "https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExN3Rtb3N5eTd4bndxb3E0cHp6cjJzcGZkaHhiMXdvaWtsemZta2JvcyZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/3o7WTDH9g8h13l42M8/giphy.gif", category: "Core" },
            { name: "Rotaciones Torácicas Cuadrúpedas", reps: "10 reps x lado", desc: `Ejecución: En cuatro puntos, mano derecha en la nuca. Baja el codo derecho hacia la muñeca izquierda, luego ábrelo girando el torso hacia el techo. Sigue el codo con la mirada.\n\n<span class='highlight-benefit'>Ayuda a:</span> Liberar la rigidez de la espalda media, crucial para la salud de hombros y espalda baja.`, img: "https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExbHRhOW55emM4ZXR2NXRoZzM3b3g2c3E0eWd6amFtcjRyeGNoMzdoZyZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/StKiS6x69pgk1r1fhG/giphy.gif", category: "Movilidad"}
        ],
        "2": [
            { name: "Círculos de Brazos y Piernas", reps: "10 por dirección", desc: `Ejecución: De pie, realiza círculos amplios y controlados con los brazos (hacia adelante y atrás). Luego, apóyate en una pared y haz lo mismo con las piernas, moviendo desde la cadera.\n\n<span class='highlight-benefit'>Ayuda a:</span> Aumentar la temperatura y lubricar las articulaciones de hombros y caderas, preparándolas para el movimiento.`, img: "https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExemRjN2RkM2NjbHYzNWs0cmk0OHlqbGtiNmJzZDk4a2ZqamM5M2Z2ZyZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/J06U94T1yA1J3w2y9W/giphy.gif", category: "Movilidad" },
            { name: "Sentadilla Profunda con Rotación", reps: "8 reps x lado", desc: `Ejecución: Baja a una sentadilla profunda. Apoya un codo en la cara interna de la rodilla y rota el torso levantando el otro brazo hacia el techo. Sigue la mano con la mirada.\n\n<span class='highlight-benefit'>Ayuda a:</span> Mejorar la movilidad de cadera, tobillos y espalda media, ideal para contrarrestar los efectos de estar sentado.`, img: "https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExOTVsczZpZWFyMXV1OHB6MGQ3MTI4dnYzbnZpdThldnRzZzVjNmg1aiZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/1BfS103n2wFj2/giphy.gif", category: "Movilidad" },
            { name: "Plancha con Pasos Laterales", reps: "20 pasos totales", desc: `Ejecución: En plancha alta, da pequeños pasos laterales con mano y pie del mismo lado simultáneamente. Mantén el core firme y las caderas bajas.\n\n<span class='highlight-benefit'>Ayuda a:</span> Activar core y hombros de forma dinámica, fortaleciendo oblicuos y estabilizadores de cadera.`, img: "https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExbHN1aXc1eGFtdzU2dWVmaDUyOGQ1N3M1OHM3cmNybjI1ZWZqbmx1NSZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/Ier1HoPq36Yve/giphy.gif", category: "Core" },
            { name: "Bisagra de Cadera (Good Morning)", reps: "15 reps", desc: `Ejecución: De pie, manos en la nuca. Empuja las caderas hacia atrás manteniendo la espalda recta. Baja el torso hasta sentir un estiramiento en isquiotibiales y vuelve empujando las caderas hacia adelante.\n\n<span class='highlight-benefit'>Ayuda a:</span> Enseñar el patrón correcto para levantar peso, activando y fortaleciendo toda la cadena posterior.`, img: "https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExM3ZtdmFxanowY2hncXp1dGk5eHk5cHJ0eTVwbnFpMDZtczJuMDU0dyZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/3o7aD2v3Q0T6nInA0U/giphy.gif", category: "Fuerza" }
        ],
        "3": [
            { name: "Saltos de Tijera (Jumping Jacks)", reps: "30 segundos", desc: `Ejecución: Salta abriendo pies y subiendo brazos por los lados hasta que se toquen sobre la cabeza. Vuelve a la posición inicial con otro salto.\n\n<span class='highlight-benefit'>Ayuda a:</span> Elevar rápidamente el ritmo cardíaco y la temperatura corporal, preparando todo el cuerpo para un esfuerzo intenso.`, img: "https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExNzh6d296anRocG5uZXdmbnA0N3lrY3Njd3Z4eHZlcG0yZ3J0cmc5YiZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/2wZ0gLPqY45c4/giphy.gif", category: "Potencia" },
            { name: "Sentadilla a Zancada Inversa", reps: "8 reps x lado", desc: `Ejecución: Realiza una sentadilla completa. Al subir, lleva una pierna directamente hacia atrás a una zancada inversa. Alterna la pierna en cada repetición.\n\n<span class='highlight-benefit'>Ayuda a:</span> Desafiar la coordinación, el equilibrio y la fuerza, mejorando la transferencia de potencia entre patrones de movimiento.`, img: "https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExNGk1MmM5aXp5M3hxYXBpOTJ5eG53NHRjc2c3aWdyN2M5MWRtdnUwMyZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/s3tC8iA64J2rS/giphy.gif", category: "Coordinación" },
            { name: "Plancha a Perro Boca Abajo", reps: "12 reps", desc: `Ejecución: Desde plancha alta, eleva las caderas hacia arriba y atrás (Perro Boca Abajo), estirando la parte posterior del cuerpo. Regresa a plancha.\n\n<span class='highlight-benefit'>Ayuda a:</span> Mejorar la flexibilidad y la fuerza simultáneamente, estirando la cadena posterior mientras se activa el core.`, img: "https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExZHh3aWF0cjVwNDI2cGk3OXl4eGVhNXBndW13ZG5vYnljZjh5NnhvYyZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/4Zd5C68u21Pj1tYdYx/giphy.gif", category: "Movilidad" },
            { name: "Paseo del Monstruo (con banda)", reps: "10 pasos x lado", desc: `Ejecución: Con una minibanda sobre las rodillas, baja a media sentadilla. Da pasos laterales controlados sin dejar que las rodillas se junten.\n\n<span class='highlight-benefit'>Ayuda a:</span> Activar y fortalecer el glúteo medio, un músculo clave para la estabilidad de la cadera y la prevención del dolor de rodilla.`, img: "https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExZ2d1ZnBvOWg0b2l0aTF3Z2lhcWk1N2VwYzZocnBnaDRnaWVmYm9oNyZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/J1uMvyh4tU3Cg/giphy.gif", category: "Fuerza" }
        ]
    },
    cooldowns: {
        "1": [
            { name: "Estiramiento de Isquiotibiales", reps: "45 seg x lado", desc: "Sentado, una pierna estirada, inclínate hacia adelante desde la cadera, manteniendo la espalda recta.", img: "https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExM3d6dWcyMnM2ZnAwbTlsMnV4ejg0aTR6MmY4azlqajZocnhxaG13NSZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/3o6wNq9R31342qj32g/giphy.gif", category: "Flexibilidad" },
            { name: "Estiramiento de Cuádriceps (de pie)", reps: "45 seg x lado", desc: "De pie, lleva el talón al glúteo, manteniendo las rodillas juntas y la cadera neutra.", img: "https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExZzYycjJzb2Vnc3ZpaXR2bnJ3aDVqZ2xha2Q0cjlhcHg5ZWlmdndraSZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/osl16i05s8acmYI2A2/giphy.gif", category: "Flexibilidad" },
            { name: "Postura del Niño", reps: "60 seg", desc: "De rodillas, lleva la cadera hacia los talones y extiende los brazos al frente, relajando la espalda.", img: "https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExeWZjbzQ3cnV0NDB4NWVjbjlqNDZ6ZmZ2c2U5c3JvMTh0b2tqemV2NSZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/4ZeD0ig26WNSk/giphy.gif", category: "Flexibilidad" },
            { name: "Torsión Espinal (tumbado)", reps: "45 seg x lado", desc: "Tumbado, lleva una rodilla al pecho y luego crúzala suavemente por encima del cuerpo, manteniendo los hombros en el suelo.", img: "https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExcGdyamk2amVmd2d5NGI3OWJpN2t0NTY1M2N0eDViMDl4eTd5MnFrMSZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/l0O9A6A3j2g0aZ3gI/giphy.gif", category: "Movilidad" }
        ],
        "2": [
            { name: "Estiramiento de la Paloma", reps: "60 seg x lado", desc: "Desde una posición de plancha, lleva una rodilla hacia la mano del mismo lado y extiende la otra pierna hacia atrás. Es un estiramiento profundo para el glúteo y el psoas.", img: "https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExNzdwZHpnaXk3bTJqNHJ5ZnM1NW1nNXdxdjQzZnducHFlMzlhY2k1dCZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/2wZ0gLPqY45c4/giphy.gif", category: "Flexibilidad" },
            { name: "Estiramiento de Aductores (Mariposa)", reps: "60 seg", desc: "Sentado, junta las plantas de los pies y presiona suavemente las rodillas hacia el suelo para estirar la cara interna de los muslos.", img: "https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExdWw0eDlyZDVwbmE2am1iNmNlZXN5dmVvOGI0enRncDFja2ZqYXN4bCZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/oB1vUAcH4S3Is/giphy.gif", category: "Flexibilidad" },
            { name: "Estiramiento de Hombro Cruzado", reps: "45 seg x brazo", desc: "Lleva un brazo recto a través del pecho y presiona suavemente con el otro para estirar el hombro.", img: "https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExM3FucjB6aDNscTh0NXFmOGp1dzQ1dnlvMWQ2dzFmMG1wYm5sMHdqeiZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/l0MYxV67D3t1Cscuc/giphy.gif", category: "Flexibilidad" },
            { name: "Postura del Perro Boca Abajo", reps: "60 seg", desc: "Desde plancha, eleva la cadera al techo, formando una 'V' invertida. Mantén la posición para estirar toda la cadena posterior.", img: "https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExZHh3aWF0cjVwNDI2cGk3OXl4eGVhNXBndW13ZG5vYnljZjh5NnhvYyZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/4Zd5C68u21Pj1tYdYx/giphy.gif", category: "Movilidad" }
        ],
        "3": [
            { name: "Estiramiento del 'Couch Stretch'", reps: "60 seg x lado", desc: "Coloca una rodilla en el suelo junto a una pared y el pie de esa misma pierna sobre la pared. Da un paso adelante con la otra pierna. Es el estiramiento más efectivo para cuádriceps y flexores de cadera.", img: "https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExcGdyamk2amVmd2d5NGI3OWJpN2t0NTY1M2N0eDViMDl4eTd5MnFrMSZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/l0O9A6A3j2g0aZ3gI/giphy.gif", category: "Flexibilidad" },
            { name: "Estiramiento de la Rana", reps: "60 seg", desc: "A gatas, separa las rodillas lo más que puedas y apoya los antebrazos en el suelo. Es un estiramiento profundo para los aductores.", img: "https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExM3ZtdmFxanowY2hncXp1dGk5eHk5cHJ0eTVwbnFpMDZtczJuMDU0dyZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/3o7aD2v3Q0T6nInA0U/giphy.gif", category: "Flexibilidad" },
            { name: "Estiramiento de Tríceps sobre la Cabeza", reps: "45 seg x brazo", desc: "Levanta un brazo, flexiona el codo y lleva la mano hacia la espalda. Usa la otra mano para presionar suavemente el codo hacia abajo.", img: "https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExNzdwZHpnaXk3bTJqNHJ5ZnM1NW1nNXdxdjQzZnducHFlMzlhY2k1dCZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/2wZ0gLPqY45c4/giphy.gif", category: "Flexibilidad" },
            { name: "Estiramiento de Muñecas y Antebrazos", reps: "30 seg cada posición", desc: "A gatas, apoya las palmas en el suelo con los dedos apuntando hacia ti. Luego, apoya el dorso de las manos.", img: "https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExd2Z0eXNsa2RtaGs4aTRlM2ZxM2Z2b2pucXFqaHNxcnRibXkxYTVpNiZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/27c3yD3aAI36pYd95n/giphy.gif", category: "Movilidad" }
        ]
    },
    months: {
        "1": {
            title: "Mes 1: Adaptación y Técnica",
            interval: "40s trabajo / 20s descanso", rounds: "3-4", hiit_duration: 20,
            days: {
                "day1": { title: "Día 1: Empuje y Core", theme: "day1", exercises: [
                    { name: "Sentadilla (Peso Corporal)", desc: "Ejecución: De pie, pies al ancho de hombros, baja la cadera hacia atrás y abajo como si te sentaras. Mantén la espalda recta y el pecho erguido. Baja hasta que los muslos estén paralelos al suelo y empuja desde los talones para subir.\n\n<span class='highlight-benefit'>Ayuda a:</span> Fortalecer cuádriceps, glúteos e isquiotibiales. Mejora tu capacidad para levantarte y saltar.", category: "Fuerza", img: "https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExM3ZtdmFxanowY2hncXp1dGk5eHk5cHJ0eTVwbnFpMDZtczJuMDU0dyZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/3o7aD2v3Q0T6nInA0U/giphy.gif" },
                    { name: "Flexiones Inclinadas", desc: "Ejecución: Apoya las manos en una superficie elevada (mesa, sofá). Cuanto más alta, más fácil. Con el cuerpo recto, baja el pecho hacia la superficie y empuja para volver.\n\n<span class='highlight-benefit'>Ayuda a:</span> Fortalecer pecho, hombros y tríceps. Es la progresión perfecta hacia una flexión completa.", category: "Fuerza", img: "https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExZ2d1ZnBvOWg0b2l0aTF3Z2lhcWk1N2VwYzZocnBnaDRnaWVmYm9oNyZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/J1uMvyh4tU3Cg/giphy.gif" },
                    { name: "Plancha Frontal", desc: "Ejecución: Apoya los antebrazos en el suelo, codos bajo los hombros. Mantén el cuerpo en línea recta, contrayendo abdomen y glúteos. No dejes que la cadera caiga.\n\n<span class='highlight-benefit'>Ayuda a:</span> Desarrollar resistencia en todo el core, proteger la espalda baja y mejorar la postura.", category: "Core", img: "https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExZHh3aWF0cjVwNDI2cGk3OXl4eGVhNXBndW13ZG5vYnljZjh5NnhvYyZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/4Zd5C68u21Pj1tYdYx/giphy.gif" },
                    { name: "Remo con Toalla", desc: "Ejecución: Sentado, pasa una toalla por tus pies. Tira de ella hacia tu abdomen, juntando los omóplatos. Crea tensión constante con la toalla.\n\n<span class='highlight-benefit'>Ayuda a:</span> Fortalecer la espalda alta (dorsales, romboides) y los bíceps. Crucial para una buena postura.", category: "Fuerza", img: "https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExbHN1aXc1eGFtdzU2dWVmaDUyOGQ1N3M1OHM3cmNybjI1ZWZqbmx1NSZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/Ier1HoPq36Yve/giphy.gif" },
                    { name: "Puente de Glúteos", desc: "Ejecución: Acostado boca arriba, rodillas flexionadas. Empuja desde los talones para levantar las caderas, apretando fuertemente los glúteos en la cima.\n\n<span class='highlight-benefit'>Ayuda a:</span> Aislar y activar los glúteos, el motor de tu cuerpo. Alivia la carga de la espalda baja y mejora la estabilidad de la cadera.", category: "Fuerza", img: "https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExOTVsczZpZWFyMXV1OHB6MGQ3MTI4dnYzbnZpdThldnRzZzVjNmg1aiZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/1BfS103n2wFj2/giphy.gif" }
                ]},
                "day2": { title: "Día 2: Tracción y Resistencia", theme: "day2", exercises: [
                    { name: "Zancadas Alternas", desc: "Ejecución: Da un paso largo hacia adelante y baja ambas rodillas a 90 grados, sin que la rodilla de atrás toque el suelo. Empuja para volver y alterna de pierna.\n\n<span class='highlight-benefit'>Ayuda a:</span> Fortalecer piernas y glúteos de forma unilateral, mejorando el equilibrio y la estabilidad.", category: "Fuerza", img: "https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExbHRhOW55emM4ZXR2NXRoZzM3b3g2c3E0eWd6amFtcjRyeGNoMzdoZyZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/StKiS6x69pgk1r1fhG/giphy.gif" },
                    { name: "Dominadas Australianas", desc: "Ejecución: Cuélgate de una barra baja o el borde de una mesa resistente, con los talones en el suelo. Tira de tu pecho hacia la barra, manteniendo el cuerpo recto.\n\n<span class='highlight-benefit'>Ayuda a:</span> Desarrollar la fuerza de tracción de la espalda y los brazos. Es el paso previo a las dominadas completas.", category: "Fuerza", img: "https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExN3Rtb3N5eTd4bndxb3E0cHp6cjJzcGZkaHhiMXdvaWtsemZta2JvcyZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/3o7WTDH9g8h13l42M8/giphy.gif" },
                    { name: "Escaladores (Controlados)", desc: "Ejecución: En posición de plancha alta, lleva una rodilla hacia el pecho de forma lenta y controlada, sin mover la cadera. Alterna de pierna.\n\n<span class='highlight-benefit'>Ayuda a:</span> Fortalecer el core y mejorar la resistencia cardiovascular de bajo impacto.", category: "Core", img: "https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExb214M2s2b3VwaHk4eWl6eDN6a2d0dHZ0ZmJpNHNqYjZocG5zZzB0ciZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/VbnUQpnihPSaVFnqHe/giphy.gif" },
                    { name: "Peso Muerto Rumano (sin peso)", desc: "Ejecución: Concéntrate en la bisagra de cadera. Empuja las caderas hacia atrás con la espalda recta y una ligera flexión de rodillas. Siente el estiramiento en los isquiotibiales.\n\n<span class='highlight-benefit'>Ayuda a:</span> Fortalecer la cadena posterior y mejorar el patrón de movimiento para levantar peso de forma segura.", category: "Movilidad", img: "https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExd2Z0eXNsa2RtaGs4aTRlM2ZxM2Z2b2pucXFqaHNxcnRibXkxYTVpNiZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/27c3yD3aAI36pYd95n/giphy.gif" },
                    { name: "Plancha Lateral", desc: "Ejecución (20s por lado): Apoya un antebrazo en el suelo, codo bajo el hombro. Levanta las caderas hasta que el cuerpo forme una línea recta. Mantén la posición.\n\n<span class='highlight-benefit'>Ayuda a:</span> Fortalecer los oblicuos y mejorar la estabilidad lateral del core, previniendo lesiones de espalda.", category: "Core", img: "https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExemRjN2RkM2NjbHYzNWs0cmk0OHlqbGtiNmJzZDk4a2ZqamM5M2Z2ZyZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/J06U94T1yA1J3w2y9W/giphy.gif" }
                ]},
                "day3": { title: "Día 3: Full Body y Transferencia", theme: "day3", exercises: [
                    { name: "Levantamiento Turco (Parcial)", desc: "Ejecución: Acostado, levanta un brazo recto. Apoyándote en el codo y luego en la mano del brazo libre, levanta las caderas del suelo. Concéntrate en la fluidez.\n\n<span class='highlight-benefit'>Ayuda a:</span> Mejorar la estabilidad del hombro, la fuerza del core y la coordinación de todo el cuerpo.", category: "Coordinación", img: "https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExNGk1MmM5aXp5M3hxYXBpOTJ5eG53NHRjc2c3aWdyN2M5MWRtdnUwMyZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/s3tC8iA64J2rS/giphy.gif" },
                    { name: "Swing (con mochila)", desc: "Ejecución: Sostén una mochila o garrafa con ambas manos. Con una bisagra de cadera, llévala entre tus piernas y luego usa un empuje explosivo de caderas para elevarla hasta la altura del pecho. El movimiento viene de la cadera, no de los brazos.\n\n<span class='highlight-benefit'>Ayuda a:</span> Desarrollar potencia explosiva en caderas y glúteos, y mejorar la resistencia.", category: "Potencia", img: "https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExNzh6d296anRocG5uZXdmbnA0N3lrY3Njd3Z4eHZlcG0yZ3J0cmc5YiZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/2wZ0gLPqY45c4/giphy.gif" },
                    { name: "Caminata del Granjero", desc: "Ejecución: Coge un objeto pesado en cada mano (garrafas de agua, mochilas). Camina con la espalda recta, el pecho erguido y el abdomen apretado. Pasos cortos y controlados.\n\n<span class='highlight-benefit'>Ayuda a:</span> Fortalecer el agarre, los trapecios, el core y mejorar la postura general bajo carga.", category: "Fuerza", img: "https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExcGdyamk2amVmd2d5NGI3OWJpN2t0NTY1M2N0eDViMDl4eTd5MnFrMSZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/l0O9A6A3j2g0aZ3gI/giphy.gif" },
                    { name: "Subidas al Cajón/Escalón", desc: "Ejecución: Sube a un escalón o silla estable con una pierna, y luego sube la otra. Baja de forma controlada, alternando la pierna que inicia el movimiento.\n\n<span class='highlight-benefit'>Ayuda a:</span> Fortalecer las piernas y glúteos, y mejorar el equilibrio y la potencia de una sola pierna.", category: "Fuerza", img: "https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExM3d6dWcyMnM2ZnAwbTlsMnV4ejg0aTR6MmY4azlqajZocnhxaG13NSZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/3o6wNq9R31342qj32g/giphy.gif" },
                    { name: "Press Pallof (con banda)", desc: "Ejecución: Ancla una banda de resistencia a la altura del pecho. De lado a la banda, sujétala con ambas manos y extiéndela al frente, resistiendo la fuerza de rotación de la banda.\n\n<span class='highlight-benefit'>Ayuda a:</span> Fortalecer el core en su función anti-rotación, clave para la estabilidad de la columna.", category: "Core", img: "https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExZzYycjJzb2Vnc3ZpaXR2bnJ3aDVqZ2xha2Q0cjlhcHg5ZWlmdndraSZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/osl16i05s8acmYI2A2/giphy.gif" }
                ]}
            }
        },
        "2": {
            title: "Mes 2: Intensificación",
            interval: "45s trabajo / 15s descanso", rounds: "4", hiit_duration: 25,
            days: {
                "day1": { title: "Día 1: Fuerza Unilateral", theme: "day1", exercises: [
                    { name: "Sentadilla Búlgara", desc: `Ejecución: Apoya el empeine de un pie en una silla o sofá detrás de ti. Da un paso adelante con la otra pierna y baja en una zancada profunda, manteniendo el torso erguido.\n\n<span class='highlight-benefit'>Ayuda a:</span> Desarrollar fuerza y masa muscular en las piernas de forma unilateral, retando el equilibrio y la estabilidad.`, category: "Fuerza", img: "https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExeWZjbzQ3cnV0NDB4NWVjbjlqNDZ6ZmZ2c2U5c3JvMTh0b2tqemV2NSZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/4ZeD0ig26WNSk/giphy.gif" },
                    { name: "Flexiones con Liberación de Manos", desc: `Ejecución: Baja en una flexión hasta que tu pecho toque el suelo. Levanta brevemente las manos del suelo y luego empuja explosivamente hacia arriba.\n\n<span class='highlight-benefit'>Ayuda a:</span> Desarrollar potencia de empuje y fuerza en todo el rango del movimiento, eliminando puntos de estancamiento.`, category: "Potencia", img: "https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExNzdwZHpnaXk3bTJqNHJ5ZnM1NW1nNXdxdjQzZnducHFlMzlhY2k1dCZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/2wZ0gLPqY45c4/giphy.gif" },
                    { name: "Plancha con Alcance", desc: `Ejecución: En plancha alta, levanta un brazo y extiéndelo lentamente hacia adelante sin permitir que tus caderas se muevan o roten. Alterna los brazos.\n\n<span class='highlight-benefit'>Ayuda a:</span> Aumentar la dificultad de la plancha, forzando al core a trabajar más duro para resistir la rotación.`, category: "Core", img: "https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExdWw0eDlyZDVwbmE2am1iNmNlZXN5dmVvOGI0enRncDFja2ZqYXN4bCZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/oB1vUAcH4S3Is/giphy.gif" },
                    { name: "Remo a una Mano (con mochila)", desc: `Ejecución: Apoya una mano y la rodilla del mismo lado en una silla. Con la espalda recta, coge una mochila o garrafa con la otra mano y tira de ella hacia tu cadera.\n\n<span class='highlight-benefit'>Ayuda a:</span> Fortalecer la espalda de manera unilateral, corrigiendo desequilibrios musculares.`, category: "Fuerza", img: "https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExM3FucjB6aDNscTh0NXFmOGp1dzQ1dnlvMWQ2dzFmMG1wYm5sMHdqeiZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/l0MYxV67D3t1Cscuc/giphy.gif" },
                    { name: "Elevación de Cadera a una Pierna", desc: `Ejecución: Realiza un puente de glúteos normal, pero con una pierna extendida hacia el techo. Levanta y baja las caderas usando solo una pierna.\n\n<span class='highlight-benefit'>Ayuda a:</span> Aumentar la intensidad en los glúteos y mejorar la estabilidad pélvica.`, category: "Fuerza", img: "https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExZHh3aWF0cjVwNDI2cGk3OXl4eGVhNXBndW13ZG5vYnljZjh5NnhvYyZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/4Zd5C68u21Pj1tYdYx/giphy.gif" }
                ]},
                "day2": { title: "Día 2: Resistencia y Core Avanzado", theme: "day2", exercises: [
                    { name: "Zancada Inversa con Elevación", desc: `Ejecución: Da un paso largo hacia atrás en una zancada. Al volver, no apoyes el pie, sino que elevas la rodilla hacia el pecho en un movimiento explosivo.\n\n<span class='highlight-benefit'>Ayuda a:</span> Mejorar la potencia, el equilibrio dinámico y la coordinación.`, category: "Coordinación", img: "https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExNGk1MmM5aXp5M3hxYXBpOTJ5eG53NHRjc2c3aWdyN2M5MWRtdnUwMyZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/s3tC8iA64J2rS/giphy.gif" },
                    { name: "Flexiones en Pica", desc: `Ejecución: Desde una posición de 'V' invertida (Perro Boca Abajo), flexiona los codos y baja la parte superior de tu cabeza hacia el suelo. Empuja para volver.\n\n<span class='highlight-benefit'>Ayuda a:</span> Fortalecer los hombros y tríceps, siendo un gran ejercicio preparatorio para la flexión pino.`, category: "Fuerza", img: "https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExNzh6d296anRocG5uZXdmbnA0N3lrY3Njd3Z4eHZlcG0yZ3J0cmc5YiZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/2wZ0gLPqY45c4/giphy.gif" },
                    { name: "Plancha Spiderman", desc: `Ejecución: En plancha alta, lleva tu rodilla derecha hacia el codo derecho por el exterior del cuerpo. Regresa y alterna de lado.\n\n<span class='highlight-benefit'>Ayuda a:</span> Trabajar los oblicuos y flexores de cadera mientras se reta la estabilidad del core.`, category: "Core", img: "https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExcGdyamk2amVmd2d5NGI3OWJpN2t0NTY1M2N0eDViMDl4eTd5MnFrMSZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/l0O9A6A3j2g0aZ3gI/giphy.gif" },
                    { name: "Buenos Días (sin peso)", desc: `Ejecución: De pie, manos en la nuca. Realiza una bisagra de cadera empujando los glúteos hacia atrás. Mantén la espalda recta y siente el trabajo en los isquiotibiales.\n\n<span class='highlight-benefit'>Ayuda a:</span> Reforzar toda la cadena posterior con un mayor rango de movimiento que la versión del Mes 1.`, category: "Fuerza", img: "https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExZzYycjJzb2Vnc3ZpaXR2bnJ3aDVqZ2xha2Q0cjlhcHg5ZWlmdndraSZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/osl16i05s8acmYI2A2/giphy.gif" },
                    { name: "Limpia Parabrisas (Tumbado)", desc: `Ejecución: Boca arriba, brazos extendidos a los lados y piernas levantadas a 90 grados. Deja caer las piernas lentamente hacia un lado, sin tocar el suelo, y luego hacia el otro.\n\n<span class='highlight-benefit'>Ayuda a:</span> Fortalecer los oblicuos y el abdomen bajo de forma intensa.`, category: "Core", img: "https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExeWZjbzQ3cnV0NDB4NWVjbjlqNDZ6ZmZ2c2U5c3JvMTh0b2tqemV2NSZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/4ZeD0ig26WNSk/giphy.gif" }
                ]},
                "day3": { title: "Día 3: Potencia y Coordinación", theme: "day3", exercises: [
                    { name: "Sentadilla con Salto", desc: `Ejecución: Realiza una sentadilla y, desde la posición más baja, salta tan alto como puedas. Aterriza suavemente, absorbiendo el impacto con las rodillas flexionadas.\n\n<span class='highlight-benefit'>Ayuda a:</span> Desarrollar la potencia de las piernas, crucial para casi todos los deportes.`, category: "Potencia", img: "https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExNzdwZHpnaXk3bTJqNHJ5ZnM1NW1nNXdxdjQzZnducHFlMzlhY2k1dCZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/2wZ0gLPqY45c4/giphy.gif" },
                    { name: "Flexiones Declinadas", desc: `Ejecución: Coloca los pies sobre una silla o sofá y las manos en el suelo. Realiza una flexión, poniendo más énfasis en la parte superior del pecho y los hombros.\n\n<span class='highlight-benefit'>Ayuda a:</span> Aumentar la dificultad de las flexiones y trabajar el músculo pectoral desde un ángulo diferente.`, category: "Fuerza", img: "https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExdWw0eDlyZDVwbmE2am1iNmNlZXN5dmVvOGI0enRncDFja2ZqYXN4bCZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/oB1vUAcH4S3Is/giphy.gif" },
                    { name: "Burpee (sin flexión)", desc: `Ejecución: Desde una posición de pie, agáchate, apoya las manos en el suelo, salta con los pies hacia atrás hasta quedar en plancha, vuelve a saltar con los pies hacia adelante y ponte de pie.\n\n<span class='highlight-benefit'>Ayuda a:</span> Mejorar la resistencia cardiovascular y la agilidad. Es un ejercicio metabólico muy completo.`, category: "Potencia", img: "https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExM3FucjB6aDNscTh0NXFmOGp1dzQ1dnlvMWQ2dzFmMG1wYm5sMHdqeiZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/l0MYxV67D3t1Cscuc/giphy.gif" },
                    { name: "Paseo del Cangrejo", desc: `Ejecución: Sentado, apoya manos y pies en el suelo, eleva la cadera y camina hacia adelante y hacia atrás.\n\n<span class='highlight-benefit'>Ayuda a:</span> Fortalecer tríceps, hombros y glúteos, mejorando la coordinación y movilidad de forma lúdica.`, category: "Coordinación", img: "https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExZHh3aWF0cjVwNDI2cGk3OXl4eGVhNXBndW13ZG5vYnljZjh5NnhvYyZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/4Zd5C68u21Pj1tYdYx/giphy.gif" },
                    { name: "Toques al Talón (Tumbado)", desc: `Ejecución: Boca arriba, rodillas flexionadas. Levanta ligeramente los hombros del suelo e inclina el torso para tocar alternativamente cada talón con la mano del mismo lado.\n\n<span class='highlight-benefit'>Ayuda a:</span> Trabajar los oblicuos de manera muy específica.`, category: "Core", img: "https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExNGk1MmM5aXp5M3hxYXBpOTJ5eG53NHRjc2c3aWdyN2M5MWRtdnUwMyZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/s3tC8iA64J2rS/giphy.gif" }
                ]}
            }
        },
        "3": {
            title: "Mes 3: Potencia y Flujo",
            interval: "50s trabajo / 10s descanso", rounds: "4-5", hiit_duration: 30,
            days: {
                "day1": { title: "Día 1: Complejos de Fuerza", theme: "day1", exercises: [
                    { name: "Sentadilla Pistola (asistida)", desc: `Ejecución: Sujétate al marco de una puerta o una columna. Levanta una pierna y baja lentamente en una sentadilla con la otra, usando el apoyo para mantener el equilibrio y controlar el descenso.\n\n<span class='highlight-benefit'>Ayuda a:</span> Desarrollar una fuerza, equilibrio y movilidad de pierna excepcionales.`, category: "Fuerza", img: "https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExNzh6d296anRocG5uZXdmbnA0N3lrY3Njd3Z4eHZlcG0yZ3J0cmc5YiZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/2wZ0gLPqY45c4/giphy.gif" },
                    { name: "Flexión Arquero", desc: `Ejecución: Adopta una posición de flexión con las manos más separadas de lo normal. Desplaza tu peso hacia un lado y flexiona ese codo, manteniendo el otro brazo casi estirado.\n\n<span class='highlight-benefit'>Ayuda a:</span> Es un paso intermedio para la flexión a una mano, desarrollando una gran fuerza de empuje unilateral.`, category: "Fuerza", img: "https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExcGdyamk2amVmd2d5NGI3OWJpN2t0NTY1M2N0eDViMDl4eTd5MnFrMSZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/l0O9A6A3j2g0aZ3gI/giphy.gif" },
                    { name: "Plancha a Plancha Baja", desc: `Ejecución: Desde plancha de manos, baja a apoyar un antebrazo y luego el otro, hasta llegar a una plancha de codos. Invierte el movimiento para volver a subir.\n\n<span class='highlight-benefit'>Ayuda a:</span> Incrementar la resistencia y estabilidad de hombros y core de forma dinámica.`, category: "Core", img: "https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExZzYycjJzb2Vnc3ZpaXR2bnJ3aDVqZ2xha2Q0cjlhcHg5ZWlmdndraSZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/osl16i05s8acmYI2A2/giphy.gif" },
                    { name: "Remo Renegado (con garrafas)", desc: `Ejecución: En posición de plancha sobre dos garrafas de agua o mancuernas. Manteniendo la cadera estable, rema alternativamente con cada brazo.\n\n<span class='highlight-benefit'>Ayuda a:</span> Combinar la estabilidad del core con la fuerza de tracción de la espalda. Un ejercicio muy completo.`, category: "Fuerza", img: "https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExeWZjbzQ3cnV0NDB4NWVjbjlqNDZ6ZmZ2c2U5c3JvMTh0b2tqemV2NSZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/4ZeD0ig26WNSk/giphy.gif" },
                    { name: "Elevación de Piernas (Tumbado)", desc: `Ejecución: Boca arriba, manos bajo los glúteos para apoyar la espalda. Levanta las piernas rectas hasta formar 90 grados y bájalas lentamente sin que toquen el suelo.\n\n<span class='highlight-benefit'>Ayuda a:</span> Fortalecer el abdomen inferior de forma muy efectiva.`, category: "Core", img: "https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExNzdwZHpnaXk3bTJqNHJ5ZnM1NW1nNXdxdjQzZnducHFlMzlhY2k1dCZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/2wZ0gLPqY45c4/giphy.gif" }
                ]},
                "day2": { title: "Día 2: Agilidad y Resistencia Total", theme: "day2", exercises: [
                    { name: "Zancada con Salto", desc: `Ejecución: Desde una posición de zancada, salta explosivamente y cambia la posición de las piernas en el aire para aterrizar en una zancada con la pierna opuesta al frente.\n\n<span class='highlight-benefit'>Ayuda a:</span> Desarrollar la potencia y la capacidad de reacción de las piernas.`, category: "Potencia", img: "https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExdWw0eDlyZDVwbmE2am1iNmNlZXN5dmVvOGI0enRncDFja2ZqYXN4bCZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/oB1vUAcH4S3Is/giphy.gif" },
                    { name: "Flexión Hindú", desc: `Ejecución: Desde pica, baja la cabeza y el pecho en un movimiento fluido hacia adelante, como una ola, terminando en una posición de cobra (espalda arqueada, cadera baja). Invierte el movimiento para volver.\n\n<span class='highlight-benefit'>Ayuda a:</span> Mejorar la fuerza, flexibilidad y coordinación en un solo movimiento fluido.`, category: "Coordinación", img: "https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExM3FucjB6aDNscTh0NXFmOGp1dzQ1dnlvMWQ2dzFmMG1wYm5sMHdqeiZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/l0MYxV67D3t1Cscuc/giphy.gif" },
                    { name: "Oso Gateando (Bear Crawl)", desc: `Ejecución: A gatas, pero con las rodillas flotando a un par de centímetros del suelo. Avanza coordinando brazo y pierna opuestos.\n\n<span class='highlight-benefit'>Ayuda a:</span> Incrementar la fuerza y estabilidad del core y los hombros, mejorando la coordinación motora.`, category: "Coordinación", img: "https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExZHh3aWF0cjVwNDI2cGk3OXl4eGVhNXBndW13ZG5vYnljZjh5NnhvYyZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/4Zd5C68u21Pj1tYdYx/giphy.gif" },
                    { name: "Sentadilla Cosaca", desc: `Ejecución: Adopta una postura muy amplia. Desplaza tu peso hacia un lado, flexionando esa rodilla y bajando la cadera mientras mantienes la otra pierna estirada.\n\n<span class='highlight-benefit'>Ayuda a:</span> Mejorar la movilidad de la cadera y la flexibilidad de los aductores en un plano de movimiento diferente.`, category: "Movilidad", img: "https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExNGk1MmM5aXp5M3hxYXBpOTJ5eG53NHRjc2c3aWdyN2M5MWRtdnUwMyZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/s3tC8iA64J2rS/giphy.gif" },
                    { name: "Abdominales en V (V-Ups)", desc: `Ejecución: Tumbado boca arriba, levanta simultáneamente el torso y las piernas rectas para que tu cuerpo forme una 'V'. Intenta tocar los pies.\n\n<span class='highlight-benefit'>Ayuda a:</span> Fortalecer todo el recto abdominal y los flexores de cadera. Es un ejercicio de core muy avanzado.`, category: "Core", img: "https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExNzh6d296anRocG5uZXdmbnA0N3lrY3Njd3Z4eHZlcG0yZ3J0cmc5YiZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/2wZ0gLPqY45c4/giphy.gif" }
                ]},
                "day3": { title: "Día 3: Reto de Calistenia", theme: "day3", exercises: [
                    { name: "Paseo por la Pared (Wall Walk)", desc: `Ejecución: Comienza en plancha con los pies tocando la pared. Camina con los pies por la pared y con las manos hacia ella hasta que quedes en una posición vertical. Invierte el movimiento.\n\n<span class='highlight-benefit'>Ayuda a:</span> Desarrollar una increíble fuerza y confianza en los hombros y el core.`, category: "Fuerza", img: "https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExcGdyamk2amVmd2d5NGI3OWJpN2t0NTY1M2N0eDViMDl4eTd5MnFrMSZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/l0O9A6A3j2g0aZ3gI/giphy.gif" },
                    { name: "Flexión a una Mano (negativa)", desc: `Ejecución: Colócate en posición de flexión y levanta una mano del suelo. Baja lo más lento que puedas, controlando el descenso con un solo brazo.\n\n<span class='highlight-benefit'>Ayuda a:</span> Construir la fuerza excéntrica necesaria para lograr una flexión a una mano completa.`, category: "Fuerza", img: "https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExZzYycjJzb2Vnc3ZpaXR2bnJ3aDVqZ2xha2Q0cjlhcHg5ZWlmdndraSZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/osl16i05s8acmYI2A2/giphy.gif" },
                    { name: "Plancha Superman", desc: `Ejecución: Desde una plancha alta, extiende simultáneamente tu brazo derecho hacia adelante y tu pierna izquierda hacia atrás. Es como un Bird-Dog, pero desde plancha, mucho más difícil.\n\n<span class='highlight-benefit'>Ayuda a:</span> Llevar la estabilidad del core a un nivel superior.`, category: "Core", img: "https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExeWZjbzQ3cnV0NDB4NWVjbjlqNDZ6ZmZ2c2U5c3JvMTh0b2tqemV2NSZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/4ZeD0ig26WNSk/giphy.gif" },
                    { name: "Sentadilla Camarón (asistida)", desc: `Ejecución: De pie, sujeta un pie por detrás con la mano del mismo lado. Usando la otra mano para apoyarte en algo, baja en una sentadilla con la pierna de apoyo.\n\n<span class='highlight-benefit'>Ayuda a:</span> Desarrollar fuerza unilateral de pierna y una gran movilidad de rodilla y tobillo.`, category: "Fuerza", img: "https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExNzdwZHpnaXk3bTJqNHJ5ZnM1NW1nNXdxdjQzZnducHFlMzlhY2k1dCZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/2wZ0gLPqY45c4/giphy.gif" },
                    { name: "L-Sit (Tuck Sit)", desc: `Ejecución: Sentado en el suelo, apoya las manos a los lados. Empuja el suelo para levantar las caderas y lleva las rodillas hacia el pecho, manteniendo los pies sin tocar el suelo.\n\n<span class='highlight-benefit'>Ayuda a:</span> Construir una fuerza de compresión abdominal y de tríceps inmensa.`, category: "Core", img: "https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExdWw0eDlyZDVwbmE2am1iNmNlZXN5dmVvOGI0enRncDFja2ZqYXN4bCZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/oB1vUAcH4S3Is/giphy.gif" }
                ]}
            }
        }
    }
};

    // --- VARIABLES GLOBALES Y ELEMENTOS DEL DOM ---
    let completedDays = {};
    const STORAGE_KEY = 'workoutProgress';

    const planContent = document.getElementById('plan-content');
    const monthTabs = document.querySelectorAll('.month-tab');
    const progressBar = document.getElementById('progress-bar');
    const modal = document.getElementById('exercise-modal');
    const modalTitle = document.getElementById('modal-title');
    const modalImg = document.getElementById('modal-img');
    const modalDesc = document.getElementById('modal-desc');
    const modalTags = document.getElementById('modal-tags');
    const assignmentModal = document.getElementById('assignment-modal');
    const assignmentTitle = document.getElementById('assignment-title');
    const assignmentDateEl = document.getElementById('assignment-date');
    const assignmentOptionsEl = document.getElementById('assignment-options');
    const cancelAssignmentBtn = document.getElementById('cancel-assignment');
    const deleteAssignmentBtn = document.getElementById('delete-assignment');
    const viewToggle = document.getElementById('view-toggle');
    const calendarContainer = document.getElementById('calendar-container');

    let currentChart = null;
    let complianceChart = null;
    let isFullView = false;
    let planningViewDate = new Date();

    const categoryColors = {
        "Fuerza": "bg-orange-200/20 text-orange-400", "Core": "bg-yellow-200/20 text-yellow-400",
        "Movilidad": "bg-green-200/20 text-green-400", "Potencia": "bg-red-200/20 text-red-400",
        "Coordinación": "bg-sky-200/20 text-sky-400", "Flexibilidad": "bg-purple-200/20 text-purple-400"
    };

    // --- FUNCIONES DE MODALES ---
    function showModal(exercise) {
        if (!exercise) return;
        modalTitle.textContent = exercise.name;
        modalImg.src = exercise.img;
        modalDesc.innerHTML = exercise.desc.replace(/\n/g, '<br/>'); // Usar innerHTML para renderizar el span

        const activeTheme = document.getElementById('plan-content').className.match(/theme-day\d/);
        const modalDescEl = modal.querySelector('#modal-desc');
        modalDescEl.querySelectorAll('.highlight-benefit').forEach(el => {
            el.classList.remove('theme-day1', 'theme-day2', 'theme-day3');
            if (activeTheme) {
                el.classList.add(activeTheme[0]);
            }
        });
        
        modalTags.innerHTML = '';
        if (exercise.category) {
            const tag = document.createElement('span');
            tag.textContent = exercise.category;
            tag.className = `category-tag ${categoryColors[exercise.category] || 'bg-slate-100 text-slate-800'}`;
            modalTags.appendChild(tag);
        }

        modal.classList.add('open');
        modal.querySelector('.modal-content').classList.add('open');
        document.body.style.overflow = 'hidden';
    }

    function hideModal() {
        modal.classList.remove('open');
        modal.querySelector('.modal-content').classList.remove('open');
        document.body.style.overflow = 'auto';
    }

    function hideAssignmentModal() {
        assignmentModal.classList.remove('open');
        assignmentModal.querySelector('.modal-content').classList.remove('open');
        document.body.style.overflow = 'auto';
    }

    // --- FUNCIONES DE RENDERIZADO ---
    function createExerciseCard(exercise) {
        const card = document.createElement('div');
        card.className = 'exercise-card bg-gray-800/50 p-3 rounded-xl shadow-lg flex items-center gap-4 cursor-pointer hover:shadow-2xl hover:ring-2 hover:ring-orange-500 transition-all duration-300 transform hover:-translate-y-1 group';
        card.dataset.exerciseName = exercise.name;
        card.innerHTML = `
            <img src="${exercise.img}" alt="${exercise.name}" class="w-24 h-24 object-cover rounded-lg bg-slate-700 flex-shrink-0" loading="lazy" onerror="this.onerror=null;this.src='https://placehold.co/100x100/111827/d1d5db?text=Img';">
            <div class="flex-grow">
                <h4 class="font-bold text-lg text-slate-100">${exercise.name}</h4>
                ${exercise.reps ? `<p class="text-slate-400">${exercise.reps}</p>` : ''}
            </div>
            <span class="theme-arrow text-orange-500 font-bold text-3xl transition-transform duration-300 group-hover:translate-x-1">&#8594;</span>
        `;
        return card;
    }

    function renderDay(month, dayKey) {
        const dayData = planData.months[month].days[dayKey];
        const warmupData = planData.warmups[month];
        const cooldownData = planData.cooldowns[month];
        const workoutDetails = document.getElementById('workout-details');

        if (!dayData) {
            workoutDetails.innerHTML = `<div class="text-center text-slate-400 p-8 bg-gray-800/30 rounded-xl">Entrenamiento no encontrado.</div>`;
            return;
        }

        workoutDetails.innerHTML = `
            <div class="space-y-4">
                <div class="accordion-item rounded-xl shadow-lg overflow-hidden">
                    <button class="accordion-header w-full flex justify-between items-center p-5 text-left font-semibold text-xl text-slate-100">
                        <span><span class="theme-marker font-black mr-2">A</span> Calentamiento y Movilidad</span>
                        <div class="accordion-icon text-2xl relative w-6 h-6"><div class="absolute bg-current w-full h-0.5 top-1/2 -translate-y-1/2"></div><div class="absolute bg-current w-full h-0.5 top-1/2 -translate-y-1/2 transition-transform duration-500 transform rotate-90"></div></div>
                    </button>
                    <div class="accordion-content">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4" id="warmup-container"></div>
                    </div>
                </div>
                <div class="accordion-item rounded-xl shadow-lg overflow-hidden">
                    <button class="accordion-header w-full flex justify-between items-center p-5 text-left font-semibold text-xl text-slate-100">
                        <span><span class="theme-marker font-black mr-2">B</span> Circuito HIIT: ${dayData.title}</span>
                         <div class="accordion-icon text-2xl relative w-6 h-6"><div class="absolute bg-current w-full h-0.5 top-1/2 -translate-y-1/2"></div><div class="absolute bg-current w-full h-0.5 top-1/2 -translate-y-1/2 transition-transform duration-500 transform rotate-90"></div></div>
                    </button>
                    <div class="accordion-content">
                         <div class="grid grid-cols-1 md:grid-cols-2 gap-4" id="hiit-container"></div>
                    </div>
                </div>
                <div class="accordion-item rounded-xl shadow-lg overflow-hidden">
                    <button class="accordion-header w-full flex justify-between items-center p-5 text-left font-semibold text-xl text-slate-100">
                        <span><span class="theme-marker font-black mr-2">C</span> Enfriamiento y Estiramientos</span>
                         <div class="accordion-icon text-2xl relative w-6 h-6"><div class="absolute bg-current w-full h-0.5 top-1/2 -translate-y-1/2"></div><div class="absolute bg-current w-full h-0.5 top-1/2 -translate-y-1/2 transition-transform duration-500 transform rotate-90"></div></div>
                    </button>
                    <div class="accordion-content">
                         <div class="grid grid-cols-1 md:grid-cols-2 gap-4" id="cooldown-container"></div>
                    </div>
                </div>
            </div>
        `;

        const warmupContainer = document.getElementById('warmup-container');
        warmupData.forEach(ex => warmupContainer.appendChild(createExerciseCard(ex)));

        const hiitContainer = document.getElementById('hiit-container');
        dayData.exercises.forEach(ex => hiitContainer.appendChild(createExerciseCard(ex)));

        const cooldownContainer = document.getElementById('cooldown-container');
        cooldownData.forEach(ex => cooldownContainer.appendChild(createExerciseCard(ex)));

        document.querySelectorAll('.accordion-header').forEach(header => {
            header.addEventListener('click', () => {
                const item = header.parentElement;
                const content = header.nextElementSibling;
                const icon = header.querySelector('.accordion-icon div:last-child');
                const isOpen = content.classList.contains('open');

                document.querySelectorAll('.accordion-content.open').forEach(openContent => {
                    if (openContent !== content) {
                        openContent.classList.remove('open');
                        const openItem = openContent.parentElement;
                        openItem.classList.remove('illuminated');
                        openItem.querySelector('.accordion-icon div:last-child').style.transform = 'rotate(90deg)';
                    }
                });

                content.classList.toggle('open');
                item.classList.toggle('illuminated');
                icon.style.transform = content.classList.contains('open') ? 'rotate(0deg)' : 'rotate(90deg)';
            });
        });
    }

    function renderPlan(month) {
        const monthData = planData.months[month];
        planContent.innerHTML = `
            <div class="text-center mb-8">
                <h2 class="text-3xl font-bold text-slate-200">${monthData.title}</h2>
                <p class="text-md text-slate-400 mt-1"><strong>Intervalo:</strong> ${monthData.interval} | <strong>Rondas:</strong> ${monthData.rounds}</p>
            </div>
            <div id="days-nav" class="flex justify-center gap-2 md:gap-4 mb-8"></div>
            <div id="workout-details"></div>
            <div id="chart-section" class="mt-12 accordion-item rounded-xl shadow-lg p-6">
                <h3 class="text-2xl font-bold text-center mb-4 text-slate-100">Distribución de la Sesión - Mes ${month}</h3>
                <div class="chart-container mx-auto" style="height: 250px; width:100%; max-width: 400px;">
                    <canvas id="session-chart"></canvas>
                </div>
            </div>
        `;

        const daysNav = document.getElementById('days-nav');
        daysNav.innerHTML = '';
        Object.keys(monthData.days).forEach((dayKey, index) => {
            const dayBtn = document.createElement('button');
            dayBtn.className = `day-btn py-2 px-5 rounded-full font-semibold shadow-lg transition-all duration-300 transform hover:scale-105 theme-${dayKey}`;
            dayBtn.textContent = `Día ${index + 1}`;
            dayBtn.dataset.day = dayKey;
            dayBtn.dataset.month = month;
            daysNav.appendChild(dayBtn);
        });

        const firstDayButton = daysNav.querySelector('.day-btn');
        if (firstDayButton) {
            planContent.classList.remove('theme-day1', 'theme-day2', 'theme-day3');
            planContent.classList.add(`theme-${firstDayButton.dataset.day}`);
            firstDayButton.classList.add('active');
            renderDay(firstDayButton.dataset.month, firstDayButton.dataset.day);
        }

        if (currentChart) {
            currentChart.destroy();
        }
        const ctx = document.getElementById('session-chart').getContext('2d');

        const chartStructure = [
            { label: 'Calentamiento', duration: 15, color: 'rgba(251, 146, 60, 0.7)' },
            { label: 'HIIT', duration: monthData.hiit_duration, color: 'rgba(249, 115, 22, 0.9)' },
            { label: 'Enfriamiento', duration: 10, color: 'rgba(234, 88, 12, 0.8)' }
        ];

        const chartData = {
            labels: chartStructure.map(s => s.label),
            datasets: [{
                data: chartStructure.map(s => s.duration),
                backgroundColor: chartStructure.map(s => s.color),
                borderWidth: 0,
                hoverOffset: 8,
            }]
        };

        currentChart = new Chart(ctx, {
            type: 'doughnut',
            data: chartData,
            options: {
                responsive: true,
                maintainAspectRatio: false,
                cutout: '60%',
                layout: {
                    padding: 50
                },
                plugins: {
                    legend: {
                        display: false
                    },
                    tooltip: {
                        enabled: false
                    },
                    datalabels: {
                        anchor: 'end',
                        align: 'end',
                        offset: 8,
                        borderRadius: 4,
                        color: 'white',
                        backgroundColor: (context) => {
                            return context.dataset.backgroundColor;
                        },
                        padding: {
                           top: 4,
                           bottom: 4,
                           left: 6,
                           right: 6
                        },
                        font: {
                            weight: 'bold',
                            size: 11,
                        },
                        formatter: (value, context) => {
                            const label = context.chart.data.labels[context.dataIndex];
                            return `${label} (${value} min)`;
                        }
                    }
                }
            }
        });
    }

    // --- LÓGICA DE CALENDARIO Y PROGRESO ---
    function loadProgress() {
        const data = localStorage.getItem(STORAGE_KEY);
        completedDays = data ? JSON.parse(data) : {};
    }

    function saveProgress() {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(completedDays));
        updateAnalytics();
        renderTodaysWorkoutInfo();
    }

    function renderTodaysWorkoutInfo() {
        const infoBox = document.getElementById('todays-workout-info');
        if (!infoBox || isFullView) {
            if(infoBox) infoBox.innerHTML = '';
            return;
        }

        const today = new Date();
        const dateStr = `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, '0')}-${String(today.getDate()).padStart(2, '0')}`;

        const todaysEntry = completedDays[dateStr];

        if (todaysEntry) {
            const monthData = planData.months[todaysEntry.month];
            const dayData = monthData.days[todaysEntry.workout];
            const theme = dayData.theme;

            const monthNum = todaysEntry.month;
            const dayNum = Object.keys(monthData.days).indexOf(todaysEntry.workout) + 1;
            const hiitTitle = dayData.title;

            let borderColorClass = '';
            if (theme === 'day1') borderColorClass = 'theme-border-day1';
            else if (theme === 'day2') borderColorClass = 'theme-border-day2';
            else if (theme === 'day3') borderColorClass = 'theme-border-day3';

            infoBox.innerHTML = `
                <div class="bg-gray-900/50 border-l-4 ${borderColorClass} rounded-r-xl p-4 transition-all duration-300">
                    <p class="text-sm font-semibold text-slate-300 uppercase tracking-wider">Entrenamiento de Hoy</p>
                    <h4 class="text-lg font-bold text-white mt-1">${hiitTitle}</h4>
                    <p class="text-sm text-slate-400">(Mes ${monthNum}, Día ${dayNum})</p>
                    <p class="text-xs text-slate-400 mt-2 font-mono">
                        ${monthData.rounds} Rondas | ${monthData.interval.replace(' ', '')}
                    </p>
                </div>
            `;
            infoBox.style.display = 'block';
        } else {
            infoBox.innerHTML = '';
            infoBox.style.display = 'none';
        }
    }

    function renderCalendars(smartScroll = false) {
        if(isFullView){
            renderFullCalendar();
        } else {
            renderTimelineCalendar(smartScroll);
        }
        renderTodaysWorkoutInfo();
    }

    function renderTimelineCalendar(smartScroll = false) {
        const timelineWrapper = calendarContainer.querySelector('#timeline-wrapper');
        const scrollPosition = timelineWrapper ? timelineWrapper.querySelector('.timeline-container').scrollLeft : 0;

        if (!timelineWrapper) {
            calendarContainer.innerHTML = `
                <div id="timeline-wrapper">
                    <div class="flex justify-between items-center mb-2 px-2">
                        <button id="prev-timeline-month" class="p-2 rounded-full hover:bg-gray-700 transition-colors">&lt;</button>
                        <h4 id="timeline-month-year" class="text-lg font-bold text-center text-amber-400"></h4>
                        <button id="next-timeline-month" class="p-2 rounded-full hover:bg-gray-700 transition-colors">&gt;</button>
                    </div>
                    <div id="timeline-calendar" class="timeline-container flex items-center gap-2 p-2"></div>
                </div>
            `;
        }

        const timelineEl = document.getElementById('timeline-calendar');
        const monthYearEl = document.getElementById('timeline-month-year');
        timelineEl.innerHTML = '';

        monthYearEl.textContent = planningViewDate.toLocaleString('es-ES', { month: 'long', year: 'numeric' });

        const year = planningViewDate.getFullYear();
        const month = planningViewDate.getMonth();
        const daysInMonth = new Date(year, month + 1, 0).getDate();

        for (let i = 1; i <= daysInMonth; i++) {
            const day = new Date(year, month, i);
            const dateStr = `${day.getFullYear()}-${String(day.getMonth() + 1).padStart(2, '0')}-${String(day.getDate()).padStart(2, '0')}`;

            const dayEl = document.createElement('div');
            dayEl.className = 'timeline-day flex flex-col justify-center items-center';
            dayEl.dataset.date = dateStr;
            dayEl.innerHTML = `
                <span class="text-xs uppercase">${day.toLocaleString('es-ES', { weekday: 'short' })}</span>
                <span class="text-2xl font-bold">${day.getDate()}</span>
            `;

            const planStartDate = localStorage.getItem('workoutStartDate');
            if (planStartDate && day < new Date(planStartDate + 'T00:00:00')) {
                dayEl.classList.add('out-of-range');
            }

            if (completedDays[dateStr]) {
                 const theme = completedDays[dateStr].theme;
                 if(completedDays[dateStr].completed){
                     dayEl.classList.add('completed', `theme-${theme}`);
                 } else {
                     dayEl.classList.add('scheduled', `theme-${theme}`);
                 }
            }
            if(day.toDateString() === new Date().toDateString()){
                 dayEl.classList.add('today');
            }
            if(dateStr === planStartDate) {
                 dayEl.classList.add('start-date');
            }
            timelineEl.appendChild(dayEl);
        }

        if(smartScroll) {
            setTimeout(() => {
                const today = new Date();
                const planStartDate = localStorage.getItem('workoutStartDate');
                let targetEl = null;

                if (planningViewDate.getFullYear() === today.getFullYear() && planningViewDate.getMonth() === today.getMonth()) {
                    targetEl = document.querySelector('.timeline-day.today');
                } else if (planStartDate && new Date(planStartDate).getFullYear() === planningViewDate.getFullYear() && new Date(planStartDate).getMonth() === planningViewDate.getMonth()) {
                    targetEl = document.querySelector('.timeline-day.start-date');
                }

                if(targetEl) {
                    targetEl.scrollIntoView({ behavior: 'smooth', inline: 'center', block: 'nearest' });
                } else {
                     timelineEl.scrollLeft = 0;
                }
            }, 100);
        } else if (scrollPosition !== null) {
             timelineEl.scrollLeft = scrollPosition;
        }
    }

    function renderFullCalendar() {
        const todaysWorkoutInfoEl = document.getElementById('todays-workout-info');
        if(todaysWorkoutInfoEl) todaysWorkoutInfoEl.innerHTML = '';

        calendarContainer.innerHTML = `
            <div class="flex justify-between items-center mb-4">
                 <button id="prev-block-btn" class="p-2 rounded-full hover:bg-gray-700 transition-colors">&lt; 3 Meses</button>
                 <h4 id="planning-view-header" class="text-lg font-bold text-center text-amber-400"></h4>
                 <button id="next-block-btn" class="p-2 rounded-full hover:bg-gray-700 transition-colors">3 Meses &gt;</button>
            </div>
            <div id="planning-grid-container" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4"></div>
            <div id="plan-end-date-info" class="text-center text-slate-400 text-sm mt-4 flex flex-col items-center gap-2"></div>
        `;

        const planningGridContainer = document.getElementById('planning-grid-container');
        let date = new Date(planningViewDate);
        date.setDate(1);

        for (let i = 0; i < 3; i++) {
            const monthDiv = document.createElement('div');
            const monthHeader = document.createElement('h4');
            monthHeader.className = 'text-md font-bold text-center text-white mb-2';
            monthHeader.textContent = date.toLocaleString('es-ES', { month: 'long', year: 'numeric' });
            monthDiv.appendChild(monthHeader);

            const grid = document.createElement('div');
            grid.className = 'grid grid-cols-7 gap-1 text-center text-xs text-slate-400 mb-1';
            ['D', 'L', 'M', 'X', 'J', 'V', 'S'].forEach(day => grid.innerHTML += `<span>${day}</span>`);
            monthDiv.appendChild(grid);

            const daysGrid = document.createElement('div');
            daysGrid.className = 'grid grid-cols-7 gap-1';
            const year = date.getFullYear();
            const month = date.getMonth();
            const firstDayOfMonth = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();

            for (let j = 0; j < firstDayOfMonth; j++) {
                daysGrid.innerHTML += `<div></div>`;
            }

            for (let j = 1; j <= daysInMonth; j++) {
                const dayEl = document.createElement('div');
                const currentDate = new Date(year, month, j);
                const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(j).padStart(2, '0')}`;
                dayEl.className = 'grid-day';
                dayEl.textContent = j;
                dayEl.dataset.date = dateStr;

                if (completedDays[dateStr]) {
                    const theme = completedDays[dateStr].theme;
                    if (completedDays[dateStr].completed) dayEl.classList.add('completed', `theme-${theme}`);
                    else dayEl.classList.add('scheduled', `theme-${theme}`);
                }
                if (currentDate.toDateString() === new Date().toDateString()) dayEl.classList.add('today');

                const planStartDate = localStorage.getItem('workoutStartDate');
                if(planStartDate) {
                    const startDateObj = new Date(planStartDate + 'T00:00:00');
                    const rangeEndDate = new Date(startDateObj);
                    rangeEndDate.setDate(startDateObj.getDate() + 83);

                    if (currentDate >= startDateObj && currentDate <= rangeEndDate) {
                        dayEl.classList.add('in-range');
                    } else {
                         dayEl.classList.add('out-of-range');
                    }
                     if(dateStr === planStartDate) dayEl.classList.add('start-date');
                }

                daysGrid.appendChild(dayEl);
            }
            monthDiv.appendChild(daysGrid);
            planningGridContainer.appendChild(monthDiv);
            date.setMonth(date.getMonth() + 1);
        }

        const infoContainer = document.getElementById('plan-end-date-info');
        infoContainer.innerHTML = '';
        const planStartDate = localStorage.getItem('workoutStartDate');

        const textSpan = document.createElement('span');
        infoContainer.appendChild(textSpan);

        if (planStartDate) {
            const rangeEndDate = new Date(planStartDate);
            rangeEndDate.setDate(rangeEndDate.getDate() + 83);
            textSpan.textContent = `Tu plan termina el ${rangeEndDate.toLocaleDateString('es-ES', { day: 'numeric', month: 'long' })}.`;
        } else {
            textSpan.textContent = 'Haz clic en un día para establecer el inicio de tu plan de 12 semanas.';
        }

        const buttonWrapper = document.createElement('div');
        buttonWrapper.className = 'flex justify-center items-center gap-2';

        if (planStartDate) {
            const resetBtn = document.createElement('button');
            resetBtn.id = 'reset-start-date';
            resetBtn.className = 'text-xs bg-yellow-800/80 text-yellow-300 px-2 py-1 rounded-md hover:bg-yellow-700';
            resetBtn.textContent = 'Resetear Inicio';
            buttonWrapper.appendChild(resetBtn);
        }

        if (Object.keys(completedDays).length > 0) {
            const clearBtn = document.createElement('button');
            clearBtn.id = 'clear-all-marks';
            clearBtn.className = 'text-xs bg-red-800/80 text-red-300 px-2 py-1 rounded-md hover:bg-red-700';
            clearBtn.textContent = 'Limpiar Todo';
            buttonWrapper.appendChild(clearBtn);
        }

        if (buttonWrapper.hasChildNodes()) {
            infoContainer.appendChild(buttonWrapper);
        }
    }

    // --- MANEJADORES DE EVENTOS ---
    viewToggle.addEventListener('change', () => {
        isFullView = viewToggle.checked;
        const dot = document.querySelector('.dot');
        dot.style.transform = isFullView ? 'translateX(1.5rem)' : 'translateX(0)';
        planningViewDate = new Date();
        renderCalendars(true);
    });

    monthTabs.forEach(tab => {
        tab.addEventListener('click', () => {
            const month = tab.dataset.month;
            renderPlan(month);
            monthTabs.forEach(t => {
                t.classList.remove('tab-active');
                t.classList.add('tab-inactive');
            });
            tab.classList.add('tab-active');
            tab.classList.remove('tab-inactive');

            progressBar.style.width = `${(parseInt(month) / 3 * 100)}%`;
        });
    });

    calendarContainer.addEventListener('click', e => {
        const dayTarget = e.target.closest('.timeline-day, .grid-day');
        if (dayTarget && dayTarget.dataset.date) {
            handleDayClick(dayTarget.dataset.date);
            return;
        }

        const navTargetId = e.target.closest('button')?.id;
        switch (navTargetId) {
            case 'prev-timeline-month':
                planningViewDate.setMonth(planningViewDate.getMonth() - 1);
                renderTimelineCalendar(true);
                renderTodaysWorkoutInfo();
                break;
            case 'next-timeline-month':
                planningViewDate.setMonth(planningViewDate.getMonth() + 1);
                renderTimelineCalendar(true);
                renderTodaysWorkoutInfo();
                break;
            case 'prev-block-btn':
                planningViewDate.setMonth(planningViewDate.getMonth() - 3);
                renderFullCalendar();
                break;
            case 'next-block-btn':
                planningViewDate.setMonth(planningViewDate.getMonth() + 3);
                renderFullCalendar();
                break;
            case 'reset-start-date':
                localStorage.removeItem('workoutStartDate');
                renderCalendars();
                updateAnalytics();
                break;
            case 'clear-all-marks':
                showClearAllConfirmation();
                break;
        }
    });

    modal.addEventListener('click', (e) => {
        if (e.target === modal || e.target.closest('#modal-close')) {
            hideModal();
        }
    });

    cancelAssignmentBtn.addEventListener('click', hideAssignmentModal);

    function handleDayClick(date) {
        const entry = completedDays[date];
        const activeMonth = document.querySelector('.month-tab.tab-active').dataset.month;
        const monthWorkouts = planData.months[activeMonth].days;
        const planStartDate = localStorage.getItem('workoutStartDate');
        const clickedDate = new Date(date + 'T00:00:00');
        const today = new Date();
        today.setHours(0,0,0,0);

        if(planStartDate && clickedDate < new Date(planStartDate + 'T00:00:00')) {
            return;
        }

        assignmentDateEl.textContent = clickedDate.toLocaleDateString('es-ES', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
        assignmentOptionsEl.innerHTML = '';
        deleteAssignmentBtn.style.display = 'none';

        if (!isFullView) { // Vista de Progreso (timeline)
            if (entry) {
                entry.completed = !entry.completed;
                saveProgress();
                renderCalendars(false);
                renderDay(entry.month, entry.workout);
            } else {
                if (clickedDate < today) return;
                assignmentTitle.textContent = "Programar Entrenamiento";
                if (!planStartDate) {
                    const startPlanBtn = document.createElement('button');
                    startPlanBtn.className = 'w-full p-3 bg-green-600 rounded-lg text-white font-semibold hover:bg-green-500 transition-colors';
                    startPlanBtn.textContent = 'Establecer como Primer Día del Plan';
                    startPlanBtn.onclick = () => {
                        localStorage.setItem('workoutStartDate', date);
                        renderCalendars(false);
                        hideAssignmentModal();
                    }
                    assignmentOptionsEl.appendChild(startPlanBtn);
                }
                Object.keys(monthWorkouts).forEach(dayKey => {
                    const optionBtn = document.createElement('button');
                    optionBtn.className = 'w-full p-3 bg-gray-700 rounded-lg text-white font-semibold transition-colors';
                    optionBtn.classList.add(`assign-btn-${dayKey}`);
                    optionBtn.textContent = `Programar: ${monthWorkouts[dayKey].title}`;
                    optionBtn.onclick = () => {
                        if (!localStorage.getItem('workoutStartDate')) {
                            localStorage.setItem('workoutStartDate', date);
                        }
                        completedDays[date] = { workout: dayKey, completed: false, month: activeMonth, theme: planData.months[activeMonth].days[dayKey].theme };
                        saveProgress();
                        renderCalendars(false);
                        hideAssignmentModal();
                    };
                    assignmentOptionsEl.appendChild(optionBtn);
                });
                assignmentModal.classList.add('open');
                assignmentModal.querySelector('.modal-content').classList.add('open');
            }
            return;
        }

        // Vista de Planificación (3 meses)
        assignmentTitle.textContent = "Acciones de Planificación";
        if (entry) {
             if (!entry.completed) {
                const completeBtn = document.createElement('button');
                completeBtn.className = 'w-full p-3 bg-green-600 rounded-lg text-white font-semibold hover:bg-green-500 transition-colors mb-3';
                completeBtn.textContent = "Marcar como Realizado";
                completeBtn.onclick = () => {
                    entry.completed = true;
                    saveProgress();
                    renderCalendars();
                    hideAssignmentModal();
                };
                assignmentOptionsEl.appendChild(completeBtn);
             }

             const unmarkBtn = document.createElement('button');
             unmarkBtn.className = 'w-full p-3 bg-yellow-600 rounded-lg text-white font-semibold hover:bg-yellow-500 transition-colors';
             unmarkBtn.textContent = "Desmarcar Día (Volver a Programado)";
             unmarkBtn.onclick = () => {
                entry.completed = false;
                saveProgress();
                renderCalendars();
                hideAssignmentModal();
             };
             if(entry.completed) assignmentOptionsEl.appendChild(unmarkBtn);

             deleteAssignmentBtn.style.display = 'block';
             deleteAssignmentBtn.onclick = () => {
                delete completedDays[date];
                saveProgress();
                renderCalendars();
                hideAssignmentModal();
             };
        } else {
             if (!planStartDate) {
                if(clickedDate >= today) {
                    const startPlanBtn = document.createElement('button');
                    startPlanBtn.className = 'w-full p-3 bg-green-600 rounded-lg text-white font-semibold hover:bg-green-500 transition-colors';
                    startPlanBtn.textContent = `Establecer como Primer Día`;
                    startPlanBtn.onclick = () => {
                        localStorage.setItem('workoutStartDate', date);
                        renderCalendars();
                        hideAssignmentModal();
                    };
                    assignmentOptionsEl.appendChild(startPlanBtn);
                }
            }
            Object.keys(monthWorkouts).forEach(dayKey => {
                const optionBtn = document.createElement('button');
                optionBtn.className = 'w-full p-3 bg-gray-700 rounded-lg text-white font-semibold transition-colors';
                optionBtn.classList.add(`assign-btn-${dayKey}`);
                optionBtn.textContent = `Programar: ${monthWorkouts[dayKey].title}`;
                optionBtn.onclick = () => {
                    if (!localStorage.getItem('workoutStartDate')) {
                        localStorage.setItem('workoutStartDate', date);
                    }
                    completedDays[date] = { workout: dayKey, completed: false, month: activeMonth, theme: planData.months[activeMonth].days[dayKey].theme };
                    saveProgress();
                    renderCalendars();
                    hideAssignmentModal();
                };
                assignmentOptionsEl.appendChild(optionBtn);
            });
        }

        assignmentModal.classList.add('open');
        assignmentModal.querySelector('.modal-content').classList.add('open');
        document.body.style.overflow = 'hidden';
    }

    function showClearAllConfirmation() {
        assignmentTitle.textContent = "¿Borrar Todo el Progreso?";
        assignmentDateEl.textContent = "Esta acción eliminará todas tus marcas y la fecha de inicio del plan. No se puede deshacer.";
        assignmentOptionsEl.innerHTML = '';

        const confirmBtn = document.createElement('button');
        confirmBtn.className = 'w-full p-3 bg-red-600 rounded-lg text-white font-semibold hover:bg-red-500 transition-colors';
        confirmBtn.textContent = "Sí, Limpiar Todo";
        confirmBtn.onclick = () => {
            completedDays = {};
            localStorage.removeItem('workoutStartDate');
            saveProgress();
            renderCalendars();
            hideAssignmentModal();
        };
        assignmentOptionsEl.appendChild(confirmBtn);

        deleteAssignmentBtn.style.display = 'none';
        assignmentModal.classList.add('open');
        assignmentModal.querySelector('.modal-content').classList.add('open');
        document.body.style.overflow = 'hidden';
    }

    function updateAnalytics(){
        const totalWorkoutsEl = document.getElementById('total-workouts');
        const totalComplianceEl = document.getElementById('total-compliance');
        const perfectStreakEl = document.getElementById('perfect-streak');

        const completedOnly = Object.keys(completedDays).filter(date => completedDays[date] && completedDays[date].completed).sort();

        if(completedOnly.length === 0) {
            totalWorkoutsEl.textContent = '0';
            totalComplianceEl.textContent = '0%';
            perfectStreakEl.textContent = '0';
            if(complianceChart) {
                complianceChart.destroy();
                complianceChart = null;
            }
            return;
        }

        totalWorkoutsEl.textContent = completedOnly.length;

        const startDateString = localStorage.getItem('workoutStartDate') || completedOnly[0];
        const startDate = new Date(startDateString + 'T00:00:00');
        const firstDayOfWeek = new Date(startDate);
        firstDayOfWeek.setDate(startDate.getDate() - (startDate.getDay() === 0 ? 6 : startDate.getDay() - 1));

        const weeklyData = Array(12).fill(0);
        const weekLabels = Array.from({length: 12}, (_, i) => `S${i + 1}`);

        completedOnly.forEach(dayStr => {
            const day = new Date(dayStr + 'T00:00:00');
            const weekIndex = Math.floor((day - firstDayOfWeek) / (1000 * 60 * 60 * 24 * 7));
            if(weekIndex >= 0 && weekIndex < 12) {
                weeklyData[weekIndex]++;
            }
        });

        const today = new Date();
        const weeksPassed = Math.floor((today - firstDayOfWeek) / (1000 * 60 * 60 * 24 * 7)) + 1;
        const possibleWorkouts = Math.max(1, (weeksPassed -1) * 3);
        const compliance = possibleWorkouts > 0 ? Math.min(100, (completedOnly.length / possibleWorkouts) * 100).toFixed(0) : 0;
        totalComplianceEl.textContent = `${compliance}%`;

        let perfectStreak = 0;
        let streakActive = true;
        for (let i = 0; i < 12; i++) {
            const weekStartDate = new Date(firstDayOfWeek);
            weekStartDate.setDate(firstDayOfWeek.getDate() + i * 7);
            
            // Si la semana ya pasó y no se completó, se rompe la racha
            if (weekStartDate < today && weeklyData[i] < 3) {
                streakActive = false;
            }
            
            if (weeklyData[i] >= 3 && streakActive) {
                perfectStreak++;
            } else if (streakActive === false) {
                break; // Detener el conteo una vez que la racha se rompe
            }
        }
        perfectStreakEl.textContent = perfectStreak;


        if (complianceChart) complianceChart.destroy();
        const ctx = document.getElementById('compliance-chart').getContext('2d');
        const barColors = [
            'rgba(251, 146, 60, 0.4)', // 1
            'rgba(251, 146, 60, 0.7)', // 2
            '#f97316',                 // 3 (Perfecta)
            '#f59e0b',                 // 4
            '#ef4444',                 // 5
            '#d946ef',                 // 6
            '#8b5cf6'                  // 7
        ];

        complianceChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: weekLabels,
                datasets: [{
                    label: 'Entrenamientos por Semana',
                    data: weeklyData,
                    backgroundColor: weeklyData.map(d => d > 0 ? barColors[d-1] : 'rgba(255,255,255,0.1)'),
                    borderRadius: 4,
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true,
                        max: 7,
                        ticks: { 
                            stepSize: 1, 
                            color: '#9ca3af',
                            font: {
                                size: 12
                            }
                        },
                        grid: { color: 'rgba(255, 255, 255, 0.1)' }
                    },
                    x: {
                        ticks: { color: '#9ca3af' },
                        grid: { display: false }
                    }
                },
                plugins: { 
                    legend: { display: false },
                    datalabels: {
                        formatter: (value) => value > 0 ? value : null,
                        color: 'black',
                        font: {
                            weight: 'bold',
                            size: 14
                        },
                        anchor: 'center',
                        align: 'center'
                    }
                }
            }
        });
    }

    // --- CARGA INICIAL ---
    loadProgress();
    renderCalendars(false);
    updateAnalytics();

    document.querySelectorAll('header, .sticky, #progress-section').forEach((el, index) => {
        el.classList.add('initial-hidden');
        setTimeout(() => {
            el.classList.add('fade-in');
        }, 100 * (index + 1));
    });

    // Vigilante para centrar el calendario solo cuando se hace visible
    const progressSection = document.getElementById('progress-section');
    const calendarObserver = new IntersectionObserver((entries, observer) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                renderCalendars(true); // Activa el smart scroll
                observer.unobserve(entry.target); // Se ejecuta solo una vez
            }
        });
    }, { threshold: 0.1 });

    calendarObserver.observe(progressSection);


    planContent.addEventListener('click', e => {
        const cardTarget = e.target.closest('.exercise-card');
        const dayTarget = e.target.closest('.day-btn');

        if(cardTarget){
            const exerciseName = cardTarget.dataset.exerciseName;
            const allExercises = [
                ...Object.values(planData.warmups).flat(),
                ...Object.values(planData.cooldowns).flat(),
                ...Object.values(planData.months).map(m => Object.values(m.days).map(d => d.exercises)).flat(2)
            ];
            const exercise = allExercises.find(ex => ex.name === exerciseName);
            showModal(exercise);
        } else if (dayTarget) {
            const month = dayTarget.dataset.month;
            const dayKey = dayTarget.dataset.day;

            planContent.classList.remove('theme-day1', 'theme-day2', 'theme-day3');
            planContent.classList.add(`theme-${dayKey}`);

            document.querySelectorAll('#days-nav .day-btn').forEach(btn => btn.classList.remove('active'));
            dayTarget.classList.add('active');

            renderDay(month, dayKey);
        }
    });

    renderPlan('1');

});
</script>
</body>
</html>


